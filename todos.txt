

Debugging
cat \programdata\Amazon\EC2-Windows\Launch\Log\UserdataExecution.log

$lastdate=$(Get-date).addminutes(-5);while ($True) {$newdate=get-date;get-winevent Application -ea 0 | ? {$_.TimeCreated -ge $lastdate -AND $_.TimeCreated -le $newdate}| Sort-Object TimeCreated;$lastdate=$newdate;start-sleep -milliseconds 330}

If (!(Test-Path env:chocolateyinstall)) {iwr https://chocolatey.org/install.ps1 -UseBasicParsing | iex} ; cinst -y nano

Add EBS Warming with:

  1OSWarmAllEBSVolumes:
    Description: >
      Warm all EBS volumes using an immutable parallel process (Launching Lifecycle Hook does not wait for this to complete) using the code discussed here: https://cloudywindows.io/post/fully-automated-on-demand-ebs-initialization-in-both-bash-for-linux-and-powershell-for-windows/
    Type: String
    Default: false
    AllowedValues: 
      - true
      - false  



  if [[ "${1OSWarmAllEBSVolumes}" == "true" ]]; then
    logit "EBS volume warming was configured, setting it up..."
    logit "Read more in the script comments and here: https://cloudywindows.io/post/fully-automated-on-demand-ebs-initialization-in-both-bash-for-linux-and-powershell-for-windows/"
    wget https://raw.githubusercontent.com/DarwinJS/DevOpsAutomationCode/master/InitializeDisksWithFIO.sh -O /tmp/InitializeDisksWithFIO.sh ; sudo bash /tmp/InitializeDisksWithFIO.sh -r 5
  fi 



  if ( "${1OSWarmAllEBSVolumes}" -eq "true" ) {
    logit "EBS volume warming was configured, setting it up..."
    logit "Read more in the script comments and here: https://cloudywindows.io/post/fully-automated-on-demand-ebs-initialization-in-both-bash-for-linux-and-powershell-for-windows/"
    invoke-webrequest -uri 'https://raw.githubusercontent.com/DarwinJS/DevOpsAutomationCode/master/InitializeDisksWithFIO.ps1' -outfile $env:public\InitializeDisksWithFIO.ps1 ; & $env:public\InitializeDisksWithFIO.ps1 -RepeatIntervalMinutes 5
  }